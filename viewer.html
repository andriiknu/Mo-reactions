<script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
<script src="lib/parser.js"></script>
<script>
  // Режими:
  // 1) Онлайн: ?id=ga69_pn -> завантажить data/ga69_pn.json через fetch()
  // 2) Офлайн: якщо вбудований &lt;script id="x4json" type="application/json"&gt;...&lt;/script&gt; — рендерить з нього
  (function(){
    const embedded = document.getElementById('x4json');
    if (embedded) {
      try { window.__renderX4(JSON.parse(embedded.textContent)); }
      catch(e){ document.getElementById('meta').textContent = 'Invalid embedded JSON: '+e.message; }
      return;
    }
    const params = new URLSearchParams(location.search);
    const id = params.get('id');
    if (!id) { document.getElementById('meta').textContent = 'Add ?id=ga69_pn to URL (expects /data/ga69_pn.json)'; return; }
    const url = `data/${encodeURIComponent(id)}.json`;
    fetch(url).then(r => r.json()).then(x4 => {
      window.__renderX4(x4);
    }).catch(err => {
      document.getElementById('meta').textContent = 'Failed to load '+url+': '+err;
    });
  })();
</script>
